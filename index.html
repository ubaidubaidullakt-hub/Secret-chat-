<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Secret Chat Channels</title>
<style>
body {margin:0;background:#111;color:white;font-family:Arial;}
.top {background:#222;padding:10px;display:flex;justify-content:space-between;align-items:center;}
#users {font-size:12px;padding:5px;color:#aaa;}
#messages {height:65vh;overflow-y:auto;padding:10px;}
.msg {margin:6px 0;}
.bottom {position:fixed;bottom:0;width:100%;background:#222;display:flex;}
input {padding:10px;width:70%;border-radius:6px;border:none;}
button {padding:10px;margin:5px;border-radius:6px;background:#2563eb;border:none;color:white;cursor:pointer;}
.bottom input {flex:1;padding:10px;border-radius:6px;border:none;}
select {padding:5px;border-radius:6px;margin-right:5px;}
</style>
</head>
<body>

<div class="top">
  <div>
    <select id="channelSelect"></select>
    <button onclick="createChannel()">‚ûï New Channel</button>
  </div>
  <button onclick="changeName()">‚úèÔ∏è Change Name</button>
</div>

<div id="users"></div>
<div id="messages"></div>

<div class="bottom">
  <input id="msg" placeholder="Message">
  <button onclick="send()">‚û§</button>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<script>
// üî• Firebase config - replace with yours
const firebaseConfig = {
  apiKey: "AIzaSyBfm9sdgiWVParO8zI2gP7xATUCODCLkzw",
  authDomain: "secret-chat-2f397.firebaseapp.com",
  databaseURL: "https://secret-chat-2f397-default-rtdb.firebaseio.com",
  projectId: "secret-chat-2f397",
  storageBucket: "secret-chat-2f397.appspot.com",
  messagingSenderId: "1022707339714",
  appId: "1:1022707339714:web:e5a96bd6c899fb1c59465b"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

// Username
let username = localStorage.getItem("name") || prompt("Enter your name");
localStorage.setItem("name", username);

// User ID
let userId = Math.random().toString(36).slice(2);

// Channel management
let currentChannel = "General";
const channelSelect = document.getElementById("channelSelect");

function createChannel() {
  const name = prompt("Enter new channel name");
  if (!name) return;
  const option = document.createElement("option");
  option.value = name;
  option.text = name;
  channelSelect.appendChild(option);
  channelSelect.value = name;
  switchChannel(name);
}

// Initialize default channel
function initChannel() {
  const option = document.createElement("option");
  option.value = "General";
  option.text = "General";
  channelSelect.appendChild(option);
  channelSelect.value = "General";
}
initChannel();

// Switch channel
channelSelect.addEventListener("change", () => {
  switchChannel(channelSelect.value);
});

let msgRef, usersRef;

function switchChannel(name) {
  currentChannel = name;
  document.getElementById("messages").innerHTML = "";
  document.getElementById("users").innerText = "";
  
  // Setup references
  msgRef = db.ref("rooms/" + currentChannel + "/messages");
  usersRef = db.ref("rooms/" + currentChannel + "/users");
  
  // Add self to online users
  usersRef.child(userId).set(username);
  usersRef.child(userId).onDisconnect().remove();
  
  // Show online users
  usersRef.on("value", s => {
    const u = s.val() || {};
    document.getElementById("users").innerText = "Online: " + Object.values(u).join(", ");
  });
  
  // Load messages
  msgRef.off(); // remove previous listener
  msgRef.limitToLast(200).on("child_added", snap => {
    const d = snap.val();
    const div = document.createElement("div");
    div.className = "msg";
    div.innerHTML = `<b>${d.name}</b>: ${d.text}`;
    document.getElementById("messages").appendChild(div);
  });
}

// Send message
function send() {
  const msg = document.getElementById("msg");
  if (!msg.value) return;
  msgRef.push({name:username,text:msg.value,time:Date.now()});
  msg.value = "";
}

// Change username
function changeName() {
  const n = prompt("New name");
  if (n) { username=n; localStorage.setItem("name",n); usersRef.child(userId).set(n); }
}

// Start on default channel
switchChannel(currentChannel);
</script>

</body>
</html>